# MDX Content Authoring Guide

This document establishes the standards for creating and editing content pages (`.mdx`) in **TheHouseOfPhi**.

## 1. File Structure

Every content page must start with the **Frontmatter** block (the section between `---`).

```mdx
---
layout: ../../layouts/BaseLayout.astro
title: Page Title - The House of Phi
lang: en
---
import VectorCanvas from '../../components/VectorCanvas.astro';
import * as math from 'mathjs';

<!-- Content begins here -->
```

## 2. Content Organization

### 2.1. HTML vs. Markdown
Although MDX supports HTML tags (`<article>`, `<section>`), we prefer **standard Markdown** for the body content to maintain readability and portability.

| Element | Preferred Syntax | HTML Equivalent (Avoid if possible) |
| :--- | :--- | :--- |
| **Headers** | `# Title`, `## Subtitle` | `<h1>`, `<h2>` |
| **Paragraphs** | Just text separated by empty lines | `<p>` |
| **Lists** | `- Item` or `1. Item` | `<ul>`, `<ol>` |
| **Emphasis** | `**bold**`, `*italic*` | `<strong>`, `<em>` |

### 2.2. Semantic Wrappers
You may use HTML tags when you need specific styling hooks (CSS classes) or semantic grouping that Markdown cannot provide.

*   **`<article>`**: It is recommended to wrap the main content if the Layout does not already do so.
*   **`<div>` or `<section>`**: Use sparingly, mainly for layout control (e.g., columns).

### 2.3. Header Numbering

Headers must be numbered manually according to the following hierarchy:

*   **Level 1 (`#`):** Used only once per file as the document title. This header is **not** numbered.
*   **Level 2 (`##`):** Numbered sequentially starting from 1 (e.g., `1. Section`, `2. Section`).
*   **Level 3 (`###`):** Displays the parent Level 2 number, followed by a dot, and then a sequential number starting from 1. The counter resets when the Level 2 section changes (e.g., `1.1. Subsection`, `1.2. Subsection`).

**Usage Example:**

```md
# Main Page Title

## 1. Introduction
...

### 1.1. Context
...

## 2. Methodology
```

## 3. Mathematical Expressions

We use **KaTeX** for fast, client-side math rendering. The styles are globally included in `BaseLayout.astro`, ensuring consistent rendering across all pages.

### 3.1. Syntax

#### Inline Math
Use single dollar signs (`$`) to include math within a sentence.

**Source:**
```md
The velocity vector is defined as $\vec{v} = \frac{d\vec{r}}{dt}$.
```

**Rendered:**
The velocity vector is defined as $\vec{v} = \frac{d\vec{r}}{dt}$.

#### Block Math (Display Mode)
Use double dollar signs (`$$`) to display equations on their own line, centered. **Important:** Place the `$$` delimiters on separate lines from the equation content to ensure proper rendering and support for numbering tags.

**Source:**
    ```md
    $$
    \int_{a}^{b} f(x) dx = F(b) - F(a)
    $$
    ```

**Rendered:**
$$
\int_{a}^{b} f(x) dx = F(b) - F(a)
$$

### 3.2. Numbered Equations

Use `\eqtag{}` inside the LaTeX block. The system automatically adds brackets `[]` around the number.

```md
$$
a^2 + b^2 = c^2 \eqtag{5.1}
$$
```

## 4. Graphics and Figures

We use standard Markdown syntax for both static and dynamic images. The build process automatically converts them into `<figure>` elements with captions.

**Syntax:**
```md
![Figure X.Y: Caption text](/path/to/source "Optional title attribute")
```

**Caption & Numbering:**
The text inside the square brackets `[]` (alt text) is used as the figure caption. It must follow the numbering format `X.Y`, where:
*   **X**: The number of the current Level 2 section (`##`).
*   **Y**: A sequential number starting at 1, which resets for each new Level 2 section.

### 4.1. Static Images
For standard image files (SVG, PNG, JPG), simply use the relative path to the file in the `public/` directory.

### 4.2. Dynamic Graphics (VectorCanvas)
For geometric constructions generated by code (using `CartesianPlane` or `EuclideanSpace`), use standard Markdown image syntax with the `vector:` protocol.

#### 1. Define the Logic (JavaScript)
Create a function in the corresponding page script (e.g., `src/scripts/pages/geometryPage.js`) inside the exported dictionary.

```js
import { CartesianPlane } from '/src/scripts/core/CartesianPlane.js';

export const geometryDrawings = {
    "mySvgId": (svg) => {
        // 2D Example
        const plane = new CartesianPlane(svg, -5, 5, -5, 5);
        plane.drawVector([0,0], [3,2], "v");
        plane.drawAxes("y", "x", "O");
    },
    "anotherSvgId": (svg) => {
        // 3D Example (EuclideanSpace)
        // ...
    }
};
```

**Best Practices for Scripts:**
*   **Do not** manipulate the DOM directly (e.g., `document.createElement`). Use the provided classes.
*   **Do not** call `transformCoordinates()` manually. The engines handle this.
*   **Do not** set SVG width/height manually. The `VectorCanvas` component handles sizing.

#### 2. Insert the Graphic (MDX)
Use the `vector:` protocol followed by the ID defined in your page script.

```md
![Figure X.Y: Description of the graphic](vector:mySvgId "Optional title attribute")
```

Where:
*   **X**: The number of the current Level 2 section (`##`).
*   **Y**: A sequential number starting at 1, which resets for each new Level 2 section.

## 5. Computed Values (Math.js)

Do not hardcode results of calculations in the text. Perform calculations in the **Frontmatter** and inject the variables. This ensures accuracy if input data changes.

**Step 1: Frontmatter Calculation**
```js
---
// ... imports
const radius = 5;
const area = math.pi * math.pow(radius, 2);
---
```

**Step 2: Usage in Content**
You can use curly braces `{}` to output the value.

```md
Given a circle with radius {radius} m, the area is:

$$ A = \pi r^2 = {area.toFixed(2)} \text{ m}^2 $$
```

## 6. Navigation

While global navigation should be handled by the Layout, local navigation (Table of Contents) or breadcrumbs can be added manually or via components.

```html
<nav>
    [Home](/) > [Geometry](./geometry)
</nav>
```

## 7. Cross-Referencing

To maintain clarity and navigability, it's important to reference other parts of the document correctly.

### 7.1. Referencing Sections (Native)

Headings in MDX automatically generate `id` attributes based on their text (converted to kebab-case). You can link to them using standard Markdown links.

**Source:**
```md
As seen in [File Structure](#1-file-structure), the frontmatter is required.
```

### 7.2. Referencing Equations

We do not use hyperlinks for equations. Instead, we use visual numbering and manual text references.

**1. Numbering Convention**
The content of `\tag{}` must follow the format `X.Y`, where:
*   **X**: The number of the current Level 2 section (`##`).
*   **Y**: A sequential number starting at 1, which resets for each new Level 2 section.

**2. Definition**
Use `\tag{}` inside the LaTeX block.

```md
$$
\vec{p} = m \cdot \vec{v} \tag{2.1}
$$
```

**3. Reference**
Simply write the number, between brackets `[]`, in the text.

```md
Substituting the velocity value into equation [2.1], we obtain...
```
```